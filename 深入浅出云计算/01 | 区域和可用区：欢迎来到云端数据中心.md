# 深入浅出云计算

## 01 | 区域和可用区：欢迎来到云端数据中心

- 区域是云计算的顶层概念，云服务以区域为单位对外开放；

- 区域选择需要考虑多种因素，包括但不限于地理位置、服务丰富性、开服时间、资源成本、可用区数量等；

- 可用区是区域之下的重要层级，代表独立的数据中心，一个区域内往往有多个可用区；

- 妥善将资源分布到不同可用区，可实现故障隔离，提升架构的可用性。

  

## 02 | 云虚拟机（一）：云端“攒机”，有哪些容易忽视的要点？

没啥好说的

![img](/Users/zhangjiazhen03/github/knowledge/深入浅出云计算/img/2-1.png)

## 03 | 云虚拟机（二）：眼花缭乱的虚拟机型号，我该如何选择？

**通用均衡型**的比例通常是1:4，如2核8G，这是一个经典的搭配，可用于建站、应用服务等各种常见负载，比如作为官网和企业应用程序的后端服务器等。如果你对未来工作负载的特征还没有经验和把握，那你也可以先使用通用型实例，等程序运行一段时间后再根据资源占用情况按需调整。

如果vCPU和内存比是1:2甚至1:1，那就是**计算密集型**的范畴，它可以用于进行科学计算、视频编码、代码编译等计算密集型负载。

比例为1:8及以上，一般就会被归入**内存优化型**了，比如8核64G的搭配，它在数据库、缓存服务、大数据分析等应用场景较为常见。

**图形计算型**很好理解，就是带有GPU能力的虚拟机，一般用于机器学习和深度学习模型的训练和推理。随着AI的火热，这类机器也越来越多地出现在各种研发和生产环境中。

## 04 | 云虚拟机（三）：老板要求省省省，有哪些妙招？

省钱妙招之一：使用包年包月机型

省钱妙招之二：使用竞价实例

省钱妙招之三：使用突发性能类型

省钱妙招之四：使用ARM实例

## 05 | 云硬盘：云上IO到底给不给力？

在云计算的领域，有时，我们还会把云端磁盘服务叫做块存储（Block Storage），因为它们与Linux操作系统中的块设备相对应，是云上提供的“裸盘”，可以格式化并且施加文件系统。

云硬盘与传统磁盘的真正差异在于，绝大多数的云硬盘都是**远程**的。我们都知道，在经典计算机的体系结构中，硬盘是通过本地机器内部主板的高速总线，与CPU、内存等部件相连接；而在云端，你的硬盘则很可能并不在宿主机上，而是在专用的磁盘服务器阵列中，**两者是通过数据中心内部的特有IO线路进行连接**。没错，这也正是**计算存储分离架构**的一种体现。



## 06 | 云上虚拟网络：开合有度，编织无形之网

虚拟私有网络（Virtual Private Cloud，简称VPC），是云计算网络端最重要的概念之一，它是指构建在云上的、相互隔离的、用户可以自主控制的私有网络环境。虚拟私有网络有时也称为专有网络（阿里云）或虚拟网络（Virtual Network或VNet，Azure的叫法）。

- **网段**，私有网络的内部IP区段，通常用CIDR形式来表达，如192.168.0.0/16。
- **子网**，私有网络的下级网络结构，一个私有网络可以划分多个子网，这和通常意义上的子网也是对应和一致的。阿里云中把子网形象地称为“交换机”。
- **路由表**，用于定义私有网络内流量的路由规则，决定着数据包的“下一跳”去向何方。每个子网都必须有一张关联的路由表，通常情况下，系统会自动帮你创建一个默认的路由表。
- **网关**，是对进出私有网络的流量进行把守和分发的重要节点，根据用途的不同，有多种类型，后面我们还会讲到。
- **安全组**，私有网络里虚拟机进出流量的通行或拦截规则，可以起到虚拟机网络防火墙的作用，我们曾经在[第2讲](https://time.geekbang.org/column/article/206296)中提到过它。

## 09 | 什么是PaaS？怎样深入理解和评估PaaS？

**第一个维度，就是服务是否带有内生的运行环境。**

**第二个维度，是PaaS服务存在的位置和范围，以及给予你的控制粒度。**

**第三个维度，在于服务是否是“有状态”的，也就是指服务是否具有较强的数据属性。**

**第四个维度，体现为支撑PaaS的虚拟机是否对外暴露，也就是会不会显示在ECS、EC2等虚拟机服务的门户列表中。**

评估PaaS服务成熟度：

- **功能屏蔽**：和自建服务相比，你需要研究PaaS的封装是否带来了某项功能、部分选项，还有扩展机制的屏蔽或者缺失，以及这些功能对你而言是否重要。
- **版本选择**：你需要检查PaaS所提供的软件或运行环境的版本是否丰富，最早和最新的版本各是什么，还有版本粒度是否足够细致等等。我就曾经遇到过，因为所需数据库版本在PaaS上不存在，只能选择虚拟机进行部署的情况。
- **性能极限**：确认PaaS服务所能够提供的性能极值，包括算力和存储的上限。你要和自己的需求量预测结合起来，避免“上车”后骑虎难下。
- **更新频率**：查看PaaS服务的更新日志，了解云厂商和相应团队在这个PaaS服务上，是否还在继续做投入，是否在跟进一些最新的技术趋势。
- **成本陷阱**：实际地通过POC实验，对PaaS服务进行试运行，注意要达到一定的量级，然后仔细查看它对应的账单，看看相关支出是否合理，你能否长期承受。

## 10 | 对象存储：看似简单的存储服务都有哪些玄机？

**同样是存储服务，对象存储和前面我们IaaS部分讲过的[云硬盘](https://time.geekbang.org/column/article/210423)有什么区别呢？**

**第一个主要区别，在于访问的接口与形式。**

**第二个主要区别，也是对象存储的一大特征，就是对象存储内本身不存在一个真正的文件系统，而是更接近一个键值（Key-Value）形式的存储服务。**

**第三个主要区别，在于对象存储的巨大容量。**

### 对象存储的高级特性

**第一个重要特性，是存储分层。**

为了应对不同的访问模式和频率，对象存储贴心地提供了分层的策略，你可以按照访问热度，设置**从热到冷**不同的存储级别（或者叫存储类型）。其中，存储级别为**热**的对象，存储空间占用的**成本稍高**，但访问读取不需要收取额外的费用；而存储级别越**冷**，则存储空间的单位**成本越低**，但访问读取需要收取一定的费用。到了极少访问的存档级别，数据的“解冻”可能还需要花费一些时间。

![img](/Users/zhangjiazhen03/github/knowledge/深入浅出云计算/img/10-1.png)

**第二个值得称道的特性，是生命周期管理。**

**第三个特性，则是对象的版本管理（Versioning）。**

## 11 | 应用托管服务：Web应用怎样在云上安家？

在云计算发展的早期，就已经出现了“**建站类服务**”，这正是应用托管服务的雏形。当时的建站类服务，会自动为你分配好服务器，安装好相应语言的Web环境以供你使用。在部署层面，服务通常会开放FTP端口，以便你上传服务器端的代码、脚本和资源。这是应用服务的一种轻量形式。

而更现代的应用托管服务，已经今非昔比，不但在细节选项、自动化程度上进步了许多，还包含了大量的增值服务。如果你的运用得当，它绝对是一个利器，能为你节省许多的时间精力。

**应用服务的本质就是为你的应用提供一个隔离的独立运行环境。**作为用户来讲，你可以只专注于业务逻辑，不需要来手动创建这个环境，更不需要运维这个环境。

### 应用托管的增值服务

**第一项增值服务就是监控**

**第二个方面是扩展**，也就是底层计算资源和流量需求的匹配。**这里既包含了底层机器配置的垂直扩展，也包含了机器数量层面的水平扩展。**一旦你有调整需求，只需要动动手指发出指令，就可以随时升级相应的机器配置，并无缝切换。

**第三个方面是集成**，

## 12 | 云数据库：高歌猛进的数据库“新贵”

**这类PaaS服务的朴素思想就是，将数据库服务搬到云上，让用户更方便轻松地使用、管理和维护数据库。**

整理了一张表格，按照厂商和云数据库的类型进行了梳理和比较。其中，标红的部分是相当值得你关注的自研云原生数据库。

![img](/Users/zhangjiazhen03/github/knowledge/深入浅出云计算/img/12-1.png)

**那么，云原生数据库在使用时，有什么优势和特点呢？**

**首先，更强的可扩展性。**

**其次，更高的可用性和可靠性。**



## 14 | 云上容器服务：从Docker到Kubernetes，迎接云原生浪潮

**Kubernetes虽然复杂性较高，但抽象设计出色，能够支持大量灵活的扩展**。所以云厂商在这个方面花了很多功夫，能够让很多云平台上的IaaS或PaaS功能组件，渗透到Kubernetes的体系中来，这样可以让两边有一个更紧密的集成。

![img](/Users/zhangjiazhen03/github/knowledge/深入浅出云计算/img/14-1.png)

## 15 | 无服务器计算：追求极致效率的多面手

也正因为底层没有固化的资源，无服务器计算的计费机制是与众不同的。它一般会按照**调用次数**和**调用时长**这两个指标来计费。这其实是非常灵活轻量的一种计费方式（部分云厂商计时已经可以精确到毫秒了），从成本上来看尤其适合那些偶尔触发、短时间运行的工作。这会比专门设立一台虚拟机来做同样的事情要划算很多。

云函数工作流服务，和前面基于队列的流式处理的区别。工作流服务构建的是**控制流**，定义事件发生的先后次序和条件依赖；而队列流式处理是**数据流**，是数据的传递和流向。

